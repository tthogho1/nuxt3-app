import{u as W,_ as M,g as P}from"./getWebCams.1ae5b691.js";import{a as $,r as d,b as z,e as K,w as F,o as g,f as k,h as m,i as y,u as c,j as a,F as w,k as q,l as G,c as H,t as S}from"./entry.3de234bc.js";import{f as B,K as U,P as V,F as J}from"./index.8e2ba788.js";import{webCamQuery as Q}from"./webCam.40b56a92.js";import"./nuxt-link.0da6c94e.js";const X=async function(){const h=await fetch("https://realm.mongodb.com/api/client/v2.0/app/webcamql-qrkjj/auth/providers/api-key/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"zltDLjGDHqJHzQ0tSHA3XSZJUTnV5TxBmjW2PopKInszFsDxqSAEubmtq5tRRLgm"})});if(!h.ok)throw new Error("Network response was not ok.");const _=await h.json(),p=Math.floor(new Date().getTime()/1e3);return{accessToken:_.access_token,getTime:p}},Y=["onClick"],Z=["src"],tt=a("div",null," Recommendationï¼š ",-1),et={style:{"margin-top":"3%"},class:"container"},nt={class:"row"},ot=["src"],at=["onClick"],st=a("div",{class:"m-5"},null,-1),dt=$({__name:"index",setup(h){const _=G(),p=new Worker("/searchPictureWorker.js");p.addEventListener("message",t=>{console.log(" receive from Worker: ",t.data),A.value=Array.from(t.data.data.webcams)},!1);const r=d(null),u=d({lat:0,lng:0}),E=d({position:u}),v=z(),T=W();async function b(){const t=await X();T.setAccessToken(t)}K(()=>{b(),setInterval(b,_.public.MONGODB_ATLAS_TOKEN_INTERVAL)});const x=d([]),A=d([]),N=function(t){const n=new Image;n.crossOrigin="Anonymous",n.onload=function(){const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const e=o.getContext("2d");e!=null&&e.drawImage(n,0,0);const l={base64String:o.toDataURL("image/jpeg"),token:T.accessToken};p.postMessage(l)},n.src=t},R=function(t){u.value={lat:t.location.latitude,lng:t.location.longitude}},C=function(t,n){const o=t;window.open(o,"_blank"),N(n)},D=async function(t){const n=t.getBounds(),o=n.getNorthEast(),e=n.getSouthWest(),s=e.lat(),l=o.lat(),f=e.lng(),O=o.lng(),L="Bearer "+T.accessToken;console.log("token : "+L);const j=`query {
        webcams(query:{status:"active",location:{
                        longitude_lt:${O},
                        longitude_gte:${f},
                        latitude_lt:${l},
                        latitude_gte:${s}}}
        ,limit:200
        ,sortBy:ID_ASC)`+Q+"}",i=document.getElementById("gmap");i!=null&&i!=null&&(i.style.pointerEvents="none"),x.value=await P(L,j),i!=null&&i!=null&&(i.style.pointerEvents="auto")},I=function(t,n,o){const e={url:"./images/man.png",scaledSize:new r.value.api.Size(30,30)};navigator.geolocation.getCurrentPosition(function(s){const l=s.coords.latitude,f=s.coords.longitude;t.panTo({lat:l,lng:f}),n.value={lat:l,lng:f},o.value={position:n,icon:e}},function(s){console.error(`Error getting location: ${s.message}`)})};return F(()=>{var t;return(t=r.value)==null?void 0:t.ready},t=>{if(!t||r.value==null)return;const n=r.value.map;v.query.lat===void 0||v.query.lng===void 0?I(n,u,E):u.value={lat:Number(v.query.lat),lng:Number(v.query.lng)},n.addListener("idle",o=>{D(n)})}),(t,n)=>{const o=M;return g(),k(w,null,[m(o,{class:"header"}),m(c(J),{id:"gmap",ref_key:"mapRef",ref:r,"api-key":c(_).public.GOOGLE_MAPS_API_KEY,style:{width:"100%",height:"500px"},center:u.value,zoom:15},{default:y(()=>[m(c(B),{options:E.value},null,8,["options"]),m(c(U),null,{default:y(()=>[(g(!0),k(w,null,q(x.value,(e,s)=>(g(),H(c(B),{options:{position:{lat:e.location.latitude,lng:e.location.longitude}},key:s},{default:y(()=>[m(c(V),null,{default:y(()=>[a("div",null,[a("button",{class:"link-button",onClick:l=>C(e.player.day.link,e.image.current.thumbnail)},S(e.title),9,Y)]),a("div",null,[a("img",{src:e.image.current.thumbnail},null,8,Z)])]),_:2},1024)]),_:2},1032,["options"]))),128))]),_:1})]),_:1},8,["api-key","center"]),tt,a("div",et,[a("div",nt,[(g(!0),k(w,null,q(A.value,e=>(g(),k("div",{class:"col-2",key:e.id},[a("img",{src:e.image.current.thumbnail},null,8,ot),a("div",null,[a("button",{class:"link-button",onClick:s=>R(e)},S(e.title),9,at)]),a("div",null,"country: "+S(e.location.country),1)]))),128))])]),st],64)}}});export{dt as default};
