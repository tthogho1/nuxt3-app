import{u as W,_ as M,g as P}from"./getWebCams.bac4263c.js";import{e as $,f as d,U as z,i as G,h as K,o as g,B as k,a as m,G as y,u as c,D as s,F as w,I as L,V as U,c as V,E}from"./entry.2cc51d32.js";import{f as q,K as F,P as H,F as J}from"./index.86f64dd9.js";import{webCamQuery as Q}from"./webCam.40b56a92.js";import"./nuxt-link.a9fcce68.js";const X=async function(){const h=await fetch("https://realm.mongodb.com/api/client/v2.0/app/webcamql-qrkjj/auth/providers/api-key/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"zltDLjGDHqJHzQ0tSHA3XSZJUTnV5TxBmjW2PopKInszFsDxqSAEubmtq5tRRLgm"})});if(!h.ok)throw new Error("Network response was not ok.");const _=await h.json(),p=Math.floor(new Date().getTime()/1e3);return{accessToken:_.access_token,getTime:p}},Y=["onClick"],Z=["src"],tt=s("div",null," Recommendationï¼š ",-1),et={style:{"margin-top":"3%"},class:"container"},nt={class:"row"},ot=["src"],st=["onClick"],at=s("div",{class:"m-5"},null,-1),dt=$({__name:"index",setup(h){const _=U(),p=new Worker("./js/searchPictureWorker.js");p.addEventListener("message",t=>{console.log(" receive from Worker: ",t.data),b.value=Array.from(t.data.data.webcams)},!1);const r=d(null),u=d({lat:0,lng:0}),S=d({position:u}),v=z(),T=W();async function x(){const t=await X();T.setAccessToken(t)}G(()=>{x(),setInterval(x,_.public.MONGODB_ATLAS_TOKEN_INTERVAL)});const A=d([]),b=d([]),D=function(t){const n=new Image;n.crossOrigin="Anonymous",n.onload=function(){const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const e=o.getContext("2d");e!=null&&e.drawImage(n,0,0);const l={base64String:o.toDataURL("image/jpeg"),token:T.accessToken};p.postMessage(l)},n.src=t},I=function(t){u.value={lat:t.location.latitude,lng:t.location.longitude}},N=function(t,n){const o=t;window.open(o,"_blank"),D(n)},R=async function(t){const n=t.getBounds(),o=n.getNorthEast(),e=n.getSouthWest(),a=e.lat(),l=o.lat(),f=e.lng(),O=o.lng(),B="Bearer "+T.accessToken;console.log("token : "+B);const j=`query {
        webcams(query:{status:"active",location:{
                        longitude_lt:${O},
                        longitude_gte:${f},
                        latitude_lt:${l},
                        latitude_gte:${a}}}
        ,limit:200
        ,sortBy:ID_ASC)`+Q+"}",i=document.getElementById("gmap");i!=null&&i!=null&&(i.style.pointerEvents="none"),A.value=await P(B,j),i!=null&&i!=null&&(i.style.pointerEvents="auto")},C=function(t,n,o){const e={url:"./images/man.png",scaledSize:new r.value.api.Size(30,30)};navigator.geolocation.getCurrentPosition(function(a){const l=a.coords.latitude,f=a.coords.longitude;t.panTo({lat:l,lng:f}),n.value={lat:l,lng:f},o.value={position:n,icon:e}},function(a){console.error(`Error getting location: ${a.message}`)})};return K(()=>{var t;return(t=r.value)==null?void 0:t.ready},t=>{if(!t||r.value==null)return;const n=r.value.map;v.query.lat===void 0||v.query.lng===void 0?C(n,u,S):u.value={lat:Number(v.query.lat),lng:Number(v.query.lng)},n.addListener("idle",o=>{R(n)})}),(t,n)=>{const o=M;return g(),k(w,null,[m(o,{class:"header"}),m(c(J),{id:"gmap",ref_key:"mapRef",ref:r,"api-key":c(_).public.GOOGLE_MAPS_API_KEY,style:{width:"100%",height:"500px"},center:u.value,zoom:15},{default:y(()=>[m(c(q),{options:S.value},null,8,["options"]),m(c(F),null,{default:y(()=>[(g(!0),k(w,null,L(A.value,(e,a)=>(g(),V(c(q),{options:{position:{lat:e.location.latitude,lng:e.location.longitude}},key:a},{default:y(()=>[m(c(H),null,{default:y(()=>[s("div",null,[s("button",{class:"link-button",onClick:l=>N(e.player.day.link,e.image.current.thumbnail)},E(e.title),9,Y)]),s("div",null,[s("img",{src:e.image.current.thumbnail},null,8,Z)])]),_:2},1024)]),_:2},1032,["options"]))),128))]),_:1})]),_:1},8,["api-key","center"]),tt,s("div",et,[s("div",nt,[(g(!0),k(w,null,L(b.value,e=>(g(),k("div",{class:"col-2",key:e.id},[s("img",{src:e.image.current.thumbnail},null,8,ot),s("div",null,[s("button",{class:"link-button",onClick:a=>I(e)},E(e.title),9,st)]),s("div",null,"country: "+E(e.location.country),1)]))),128))])]),at],64)}}});export{dt as default};
